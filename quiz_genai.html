<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#121212" />
  <title>Combat Drill: GenAI</title>

  <style>
    :root {
      --bg: #0e0f12;
      --panel: #1a1d22;
      --panel-2: #15181d;
      --text: #e9eef3;
      --muted: #a9b1bb;
      --border: #2a2f36;
      --yellow: #ffcc00;
      --ok: #2dd47a;
      --danger: #ff5d73;
    }

    /* reset / base */
    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      min-height: 100svh;
      overflow: hidden;
      /* no scroll ‚Äúthingy‚Äù on standard screens */
    }

    /* Back link stays fixed */
    a.back {
      position: fixed;
      top: 12px;
      left: 12px;
      color: var(--yellow);
      text-decoration: none;
      font-weight: 600;
      z-index: 10;
    }

    a.back::before {
      content: "‚¨Ö ";
    }

    /* Full-viewport center stage */
    .stage {
      min-height: 100svh;
      display: grid;
      place-items: center;
      /* centers vertically + horizontally */
      padding: 0 16px;
      /* no big bottom padding */
    }

    /* Stack title + card with 20px gap */
    .stack {
      display: grid;
      justify-items: center;
      gap: 20px;
    }

    /* Title */
    .page-head {
      margin: 0;
      text-align: center;
      font-size: clamp(1.6rem, 2.2vw + 1rem, 2.2rem);
      color: var(--yellow);
      font-weight: 800;
    }

    /* Card */
    .card {
      width: min(760px, 92vw);
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 22px;
      box-shadow: 0 8px 28px rgba(0, 0, 0, .35);
    }

    /* Optional: if someone‚Äôs screen is tiny (short laptops), allow scroll */
    @media (max-height: 620px) {
      body {
        overflow: auto;
      }
    }

    .question {
      font-size: clamp(1.05rem, .8vw + 1rem, 1.25rem);
      font-weight: 800;
      color: var(--yellow);
      margin-bottom: 14px;
      line-height: 1.4;
    }

    .options {
      display: grid;
      gap: 10px;
      margin: 14px 0 4px;
    }

    .options button {
      text-align: left;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 14px;
      background: var(--panel-2);
      color: var(--text);
      cursor: pointer;
      transition: transform .05s ease, border-color .2s ease, background .2s ease;
    }

    .options button:hover {
      transform: translateY(-1px);
      border-color: #3a404a;
    }

    .options button:disabled {
      opacity: .8;
      cursor: default;
    }

    .options button.correct {
      outline: 2px solid var(--ok);
    }

    .options button.wrong {
      outline: 2px solid var(--danger);
    }

    .feedback {
      margin-top: 12px;
      color: var(--muted);
      font-style: italic;
    }

    .toolbar {
      display: flex;
      justify-content: flex-end;
      margin-top: 14px;
    }

    .btn {
      border: 1px solid var(--border);
      background: var(--yellow);
      color: #111;
      font-weight: 800;
      border-radius: 10px;
      padding: 10px 16px;
      cursor: pointer;
    }

    .btn:disabled {
      opacity: .6;
      cursor: default;
    }

    @media (max-width:540px) {
      .card {
        padding: 16px;
      }
    }
  </style>
</head>

<body>
  <a class="back" href="steady.html">Back</a>

  <main class="stage">
    <div class="stack">
      <h1 class="page-head">‚öîÔ∏è GenAI Combat Drill</h1>
      <div id="quiz" class="card" role="region" aria-live="polite"></div>
    </div>
  </main>

  <script>
    // ---- CONFIG ----
    const JSON_URL = 'genai_quiz.json';
    const STORAGE_KEY = 'genai_quiz_state_v1';

    // ---- STATE ----
    let questions = [];
    let order = [];     // shuffled indices
    let current = 0;    // pointer into order[]

    // Fisher‚ÄìYates
    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function saveState() {
      sessionStorage.setItem(STORAGE_KEY, JSON.stringify({ order, current }));
    }

    function loadState(len) {
      try {
        const raw = sessionStorage.getItem(STORAGE_KEY);
        if (!raw) return false;
        const { order: savedOrder, current: savedCurrent } = JSON.parse(raw);
        if (!Array.isArray(savedOrder)) return false;
        if (savedOrder.length !== len) return false;
        order = savedOrder.slice();
        current = Math.min(Math.max(0, savedCurrent | 0), order.length - 1);
        return true;
      } catch { return false; }
    }

    // ---- INIT ----
    fetch(JSON_URL)
      .then(r => r.json())
      .then(data => {
        // normalize fields
        questions = data.map(q => ({
          ...q,
          answer: q.answer ?? q.correct_answer,
          explanation: q.explanation ?? ''
        }));

        // try to restore; otherwise create a fresh shuffled run
        if (!loadState(questions.length)) {
          order = shuffle([...Array(questions.length).keys()]);
          current = 0;
          saveState();
        }

        renderQuestion();
      })
      .catch(err => {
        console.error(err);
        document.getElementById('quiz').innerHTML =
          '<p style="color:#ff8080">Could not load genai_quiz.json.</p>';
      });

    // ---- RENDER ----
    function renderQuestion() {
      const $quiz = document.getElementById('quiz');
      const q = questions[order[current]];
      $quiz.innerHTML = '';

      const qEl = document.createElement('div');
      qEl.className = 'question';
      qEl.textContent = q.question;
      $quiz.appendChild(qEl);

      const opts = document.createElement('div');
      opts.className = 'options';
      q.options.forEach(opt => {
        const b = document.createElement('button');
        b.type = 'button';
        b.textContent = opt;
        b.addEventListener('click', () => handleAnswer(b, opt));
        opts.appendChild(b);
      });
      $quiz.appendChild(opts);
    }

    function handleAnswer(btn, choice) {
      const $quiz = document.getElementById('quiz');
      const q = questions[order[current]];
      const all = [...$quiz.querySelectorAll('.options button')];
      all.forEach(b => b.disabled = true);

      const isCorrect = choice === q.answer;
      if (isCorrect) {
        btn.classList.add('correct');
      } else {
        btn.classList.add('wrong');
        const correctBtn = all.find(b => b.textContent === q.answer);
        if (correctBtn) correctBtn.classList.add('correct');
      }

      const fb = document.createElement('div');
      fb.className = 'feedback';
      fb.textContent = isCorrect ? '‚úÖ Correct!' : `‚ùå Not quite. ${q.explanation}`;
      $quiz.appendChild(fb);

      const bar = document.createElement('div');
      bar.className = 'toolbar';
      const next = document.createElement('button');
      next.className = 'btn';
      next.textContent = current < order.length - 1 ? 'Next' : 'Finish';
      next.addEventListener('click', nextQuestion);
      bar.appendChild(next);
      $quiz.appendChild(bar);
    }

    function nextQuestion() {
      current++;
      saveState();
      if (current < order.length) {
        renderQuestion();
      } else {
        sessionStorage.removeItem(STORAGE_KEY); // run complete
        document.getElementById('quiz').innerHTML =
          `<div class="question" style="color:var(--text)">You completed the drill üí™</div>`;
      }
    }
  </script>


</body>

</html>